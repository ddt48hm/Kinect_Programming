<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Kinect programming by HisatakaSuzuki</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Kinect programming</h1>
        <p class="header">I'll upload Kinect Programming source codes here.</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/HisatakaSuzuki/Kinect_Programming/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/HisatakaSuzuki/Kinect_Programming/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/HisatakaSuzuki/Kinect_Programming">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/HisatakaSuzuki">HisatakaSuzuki</a></p>


      </header>
      <section>
        <h3>
<a name="%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB" class="anchor" href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><span class="octicon octicon-link"></span></a>はじめに</h3>

<p>このページは大学の授業で行ったKinect演習の中間レポートである。<br>
チームを組んでKinectプログラミングを行ったときに経験したことをまとめた。<br></p>

<h3>
<a name="%E5%88%B6%E4%BD%9C%E6%A6%82%E8%A6%81" class="anchor" href="#%E5%88%B6%E4%BD%9C%E6%A6%82%E8%A6%81"><span class="octicon octicon-link"></span></a>制作概要</h3>

<p>私たちは大学の授業でTeam DaruMAというチームを組んだ。<br>
チーム制作ではKinectを用いてだるまさんが転んだが出来るゲームの制作を行った。<br>
制作を行う前に、Kinectの前でだるまさんが転んだをやるにはKinectの認識範囲(80cm~4m)は<br>
短すぎるという話し合いになったので、Kinectの認識範囲内を往復するシャトルラン形式での<br>
だるまさんが転んだの実装を行うことにした。<br></p>

<h3>
<a name="%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E6%A6%82%E8%A6%81" class="anchor" href="#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E6%A6%82%E8%A6%81"><span class="octicon octicon-link"></span></a>システム概要</h3>

<p>制作したシステムは「だるまさんが転んだ」と「シャトルラン」の要素を持っていたので「だるまさんシャトルラン」と命名した。
「だるまさんシャトルラン」ではKinectの認識範囲以外にも解決事項があった。<br>
その要件定義を以下にリストとしてまとめた。</p>

<ul>
<li>Kinectの認識可能範囲内(80cm~4m)で遊べること</li>
<li>(シャトルランをするので)画面を見なくても遊べること</li>
<li>「だるまさんが転んだ」の音声パターンは数種類あること</li>
</ul><h3>
<a name="%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E5%86%85%E5%AE%B9" class="anchor" href="#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E5%86%85%E5%AE%B9"><span class="octicon octicon-link"></span></a>システム内容</h3>

<p>システムの要件定義を満たす実装をするにあたり必要となる機能をまとめる。<br></p>

<ol>
<li>「だるまさんが転んだ」の再生処理</li>
<li>シャトルランの判定処理</li>
<li>だるまさんが転んだの動いてしまったかの判定処理(動いちゃた判定)</li>
</ol><h4>
<a name="%E3%81%A0%E3%82%8B%E3%81%BE%E3%81%95%E3%82%93%E3%81%8C%E8%BB%A2%E3%82%93%E3%81%A0%E3%81%AE%E5%86%8D%E7%94%9F%E5%87%A6%E7%90%86" class="anchor" href="#%E3%81%A0%E3%82%8B%E3%81%BE%E3%81%95%E3%82%93%E3%81%8C%E8%BB%A2%E3%82%93%E3%81%A0%E3%81%AE%E5%86%8D%E7%94%9F%E5%87%A6%E7%90%86"><span class="octicon octicon-link"></span></a>「だるまさんが転んだ」の再生処理</h4>

<p>このパートは私が担当し、<a href="http://bit.ly/1cZQHnc">playDaruMA.cs</a>で記述している。
ソース内で作成しているメソッドを次の図で示す。<br><img src="https://github.com/HisatakaSuzuki/Kinect_Programming/blob/master/images/prog1.png?raw=true" alt="playDaruma"><br>
SoundPlayerを使用して音声の再生を行っている。PlaySound()とStopSound()は外部のファイルからアクセスされることはなく、外部からはplay()を介して音声を再生するようになっている。
当初サウンドは「だ」「る」「ま」「さ」「ん」「が」「こ」「ろ」「ん」「だ」の一音ずつの音声を
準備して次の音声を呼ぶ間隔をランダムにして、<br>「だるまさんがころんだ」にランダム性を持たせていた。
しかしそれでは音と音の繋ぎの滑らかさが表現できなかったので、最終的には「だるまさんが転んだ」を
一音声ファイルとしてそのパターンを6種類用意する方法に切り替えた。</p>

<h4>
<a name="%E3%82%B7%E3%83%A3%E3%83%88%E3%83%AB%E3%83%A9%E3%83%B3%E3%81%AE%E5%88%A4%E5%AE%9A%E5%87%A6%E7%90%86" class="anchor" href="#%E3%82%B7%E3%83%A3%E3%83%88%E3%83%AB%E3%83%A9%E3%83%B3%E3%81%AE%E5%88%A4%E5%AE%9A%E5%87%A6%E7%90%86"><span class="octicon octicon-link"></span></a>シャトルランの判定処理</h4>

<p>シャトルランの判定処理は<a href="http://bit.ly/19tMgA6">CheckClass.cs</a>で記述している。
ソース内でポイントを追加するaddPoint()と進行方向を変えるchangeDir()を記述している。下図はaddPoint()である。
<img src="https://github.com/HisatakaSuzuki/Kinect_Programming/blob/master/images/prog2.png?raw=true" alt="addPoint"><br>
上図のaddPoint()はプレイヤーの骨格情報sklSRと、プレイヤーのポイントcounterSRと、進行方向の情報flagSRを引数とし、
進行方向による条件分岐にプレイヤーの骨格情報がポイントを加算するのにふさわしいかどうかをチェックする関数である。
changeDir()も同じ条件で進行方向を反転するかどうかをチェックする関数となっている。</p>

<h4>
<a name="%E5%8B%95%E3%81%84%E3%81%A1%E3%82%83%E3%81%A3%E3%81%9F%E5%88%A4%E5%AE%9A%E3%81%AE%E5%87%A6%E7%90%86" class="anchor" href="#%E5%8B%95%E3%81%84%E3%81%A1%E3%82%83%E3%81%A3%E3%81%9F%E5%88%A4%E5%AE%9A%E3%81%AE%E5%87%A6%E7%90%86"><span class="octicon octicon-link"></span></a>動いちゃった判定の処理</h4>

<p>動いてはいけないときに動いてしまったときの処理は<a href="http://bit.ly/19tSCPX">JudgeClass.cs</a>で記述している。
この処理で一番大事な処理が下図のJudge_Skel()関数である。<br><img src="https://github.com/HisatakaSuzuki/Kinect_Programming/blob/master/images/prog3.png?raw=true" alt="Judge_Skel"><br>
この関数を呼び出すことで、頭と両手の骨格情報と保存した骨格情報の差異でプレイヤーが動いたかどうかを判定している。</p>

<h3>
<a name="%E9%81%8A%E3%81%B3%E6%96%B9%E3%83%9E%E3%83%8B%E3%83%A5%E3%82%A2%E3%83%AB" class="anchor" href="#%E9%81%8A%E3%81%B3%E6%96%B9%E3%83%9E%E3%83%8B%E3%83%A5%E3%82%A2%E3%83%AB"><span class="octicon octicon-link"></span></a>遊び方マニュアル</h3>

<h4>
<a name="%E9%81%8A%E3%81%B3%E3%81%AE%E6%B5%81%E3%82%8C" class="anchor" href="#%E9%81%8A%E3%81%B3%E3%81%AE%E6%B5%81%E3%82%8C"><span class="octicon octicon-link"></span></a>遊びの流れ</h4>

<ol>
<li>Kinectの認識範囲内に入る。</li>
<li>「だるまさんが転んだ」の音声が再生されたら下図の①と②の間でシャトルランを行う。</li>
<li>音声が鳴りやんだ時には、静止しなくてはならない。</li>
<li>遊びの流れ2と3をゲームオーバーになるまで繰り返す。
<img src="https://github.com/HisatakaSuzuki/Kinect_Programming/blob/master/images/system.png?raw=true" alt="システム図">
</li>
</ol><h4>
<a name="%E5%BE%97%E7%82%B9" class="anchor" href="#%E5%BE%97%E7%82%B9"><span class="octicon octicon-link"></span></a>得点</h4>

<ul>
<li>上図の①と②の間でシャトルランの切り替えしの成功時に得点が入る。</li>
</ul><h4>
<a name="%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC" class="anchor" href="#%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC"><span class="octicon octicon-link"></span></a>ゲームオーバー</h4>

<ul>
<li>遊びの流れ3の時に動いていると判定された場合はゲームオーバーとなる。</li>
</ul><h3>
<a name="%E7%99%BA%E8%A1%A8" class="anchor" href="#%E7%99%BA%E8%A1%A8"><span class="octicon octicon-link"></span></a>発表</h3>

<p>画面を見ないでも遊べる設計にするために、当初はプレイヤーの方向転換のときに決まった音声で知らせる仕様にする予定でしたが、発表には間に合わなかったのでテープで線を引くことで代用した。
発表時には1人プレイで問題なく動いたが、テストが甘かったので判定が厳しすぎてしまった。</p>

<h3>
<a name="%E5%8F%8D%E7%9C%81" class="anchor" href="#%E5%8F%8D%E7%9C%81"><span class="octicon octicon-link"></span></a>反省</h3>

<ul>
<li>ゲームデザインがうまくできていなかった。<br>
　  ┗プレイに終わる区切りがない(ゲームオーバーになるしかない)</li>
<li>結合に苦戦してしまった。<br>
┗変数の定義や、必要な動作などをしっかり決める前に各々で作業に入ってしまった。</li>
</ul>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
